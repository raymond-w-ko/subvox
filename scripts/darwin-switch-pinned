#!/usr/bin/env bash
set -euo pipefail

release="${DARWIN_RELEASE:-nix-darwin-25.05}"
attr="${1:-}"
if [[ -z "${attr}" ]]; then
  printf "usage: %s <flake-attr> [extra darwin-rebuild args]\n" "$(basename "$0")" >&2
  printf "set DARWIN_RELEASE to override (default: %s)\n" "${release}" >&2
  exit 64
fi

shift || true
sudo nix run "nix-darwin/${release}#darwin-rebuild" -- switch --flake ".#${attr}" "$@"
